[![Django-app workflow](https://github.com/mspitsyn/foodgram-project-react/actions/workflows/main.yml/badge.svg)](https://github.com/mspitsyn/foodgram-project-react/actions/workflows/main.yml)

# Foodgram - «Продуктовый помощник»

Это онлайн-сервис и API для него, где пользователи могут публиковать рецепты, подписываться на публикации других пользователей, добавлять понравившиеся рецепты в список «Избранное», а перед походом в магазин скачивать сводный список продуктов, необходимых для приготовления одного или нескольких выбранных блюд.

## Проект в интернете можно посмотреть [здесь]( http://84.201.129.171/recipes)
Учетные данные администратора:
- Имя пользователя: admin
- Пароль: admin12345

# Технологии:
    Django==3.2
    Django-rest-framework==3.12
    Python==3.7.9
    PostgreSQL
    Docker
---

# Подготовка и запуск проекта

- Склонируйте репозиторий на локальную машину.
  
### Для работы с удаленным сервером (на ubuntu):
- Выполните вход на свой удаленный сервер.
- Установите docker на сервер:
```python
sudo apt install docker.io 
```
- Установите docker-compose на сервер. [Установка и использование Docker Compose в Ubuntu 20.04](https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04-ru)
- Локально отредактируйте файл infra/nginx/default.conf.conf, в строке server_name впишите свой IP
- Скопируйте файлы docker-compose.yml и nginx.conf из папки infra на сервер:
```python
scp infra/docker-compose.yml <username>@<ip host>:/home/<username>/docker-compose.yml
scp infra/nginx.conf <username>@<ip host>:/home/<username>/nginx.conf
```

- Для работы с Workflow добавьте в Secrets GitHub переменные окружения для работы:
```
DB_ENGINE=<django.db.backends.postgresql>
DB_NAME=<имя базы данных postgres>
DB_USER=<пользователь бд>
DB_PASSWORD=<пароль>
DB_HOST=<db>
DB_PORT=<5432>

DOCKER_PASSWORD=<пароль от DockerHub>
DOCKER_USERNAME=<имя пользователя на DockerHub>

SECRET_KEY=<секретный ключ проекта django>
DEBUG=<False>

USER=<username для подключения к серверу>
HOST=<IP сервера>
SSH_KEY=<ваш SSH ключ (для получения выполните команду: cat ~/.ssh/id_rsa)>
PASSPHRASE=<если при создании ssh-ключа вы использовали фразу-пароль>

TELEGRAM_TO=<ID чата, в который придет сообщение, узнать свой ID можно у бота @userinfobot>
TELEGRAM_TOKEN=<токен вашего бота, получить этот токен можно у бота @BotFather>
Workflow состоит из четырех шагов:
```
- Workflow состоит из четырех шагов:
  * Проверка кода на соответствие PEP8 и выполнение тестов, реализованных в проекте
  * Сборка и публикация образа приложения на DockerHub.
  * Автоматическое скачивание образа приложения и деплой на удаленном сервере.
  * Отправка уведомления в телеграм-чат.

- После успешного развертывания проекта на удаленном сервере, можно выполнить:
  * Создать суперпользователя Django:
```python
sudo docker-compose exec backend python manage.py createsuperuser
```
   * Импортровать в БД ингредиенты, чтобы пользователи могли ими пользоваться при создании рецептов:
```python
sudo docker-compose exec backend python manage.py import_ingredients
```
   * Заполнить БД начальными данными (необязательно):
```python
sudo docker-compose exec backend python manage.py loaddata dump.json
```
 - Проект будет доступен по IP вашего сервера.

## Регистрация и авторизация
В сервисе предусмотрена система регистрации и авторизации пользователей.
Обязательные поля для пользователя:
<li> Логин
<li> Пароль
<li> Email
<li> Имя
<li> Фамилия

## Права доступа к ресурсам сервиса

### неавторизованные пользователи могут:

    - создать аккаунт;
    - просматривать рецепты на главной;
    - просматривать отдельные страницы рецептов;
    - фильтровать рецепты по тегам;

### авторизованные пользователи могут:

    - входить в систему под своим логином и паролем;
    - выходить из системы (разлогиниваться);
    - менять свой пароль;
    - создавать/редактировать/удалять собственные рецепты;
    - просматривать рецепты на главной;
    - просматривать страницы пользователей;
    - просматривать отдельные страницы рецептов;
    - фильтровать рецепты по тегам;
    - работать с персональным списком избранного: добавлять в него рецепты или удалять их, просматривать свою страницу избранных рецептов;
    - работать с персональным списком покупок: добавлять/удалять любые рецепты, выгружать файл со количеством необходимых ингридиентов для рецептов из списка покупок;
    - подписываться на публикации авторов рецептов и отменять подписку, просматривать свою страницу подписок;

### администратор
Администратор обладает всеми правами авторизованного пользователя.
<br> Плюс к этому он может:

    - изменять пароль любого пользователя;
    - создавать/блокировать/удалять аккаунты пользователей;
    - редактировать/удалять любые рецепты;
    - добавлять/удалять/редактировать ингредиенты;
    - добавлять/удалять/редактировать теги.


# Ресурсы сервиса

### Рецепт
Рецепт описывается полями:
    Автор публикации (пользователь).
    Название рецепта.
    Картинка рецепта.
    Текстовое описание.
    Ингредиенты: продукты для приготовления блюда по рецепту с указанием количества и единиц измерения.
    Тег.
    Время приготовления в минутах.

### Тег
Тег описывается полями:
    Название.
    Цветовой HEX-код.
    Slug.

### Ингредиент
Ингредиент описывается полями:
    Название.
    Количество (только для рецепта).
    Единицы измерения.

### Список покупок.
Список покупок скачивается в текстовом формате: shopping_cart.txt.

## Фильтрация по тегам
При нажатии на название тега выводится список рецептов, отмеченных этим тегом. Фильтрация может проводится по нескольким тегам в комбинации «или»: если выбраны несколько тегов — в результате должны быть показаны рецепты, которые отмечены хотя бы одним из этих тегов.
При фильтрации на странице пользователя фильтруются только рецепты выбранного пользователя. Такой же принцип соблюдается при фильтрации списка избранного.
---
# Примеры запросов к API.

Запросы к API начинаются с «/api/v1/»

1) регистрация пользователя

POST-запрос: /api/users/
<br /> *Request sample:*
```python
{

    "email": "string",
    "username": "string",
    "first_name": "string",
    "last_name": "string",
    "password": "string"

}
```
*Response sample (201):*
```python
{

    "email": "string",
    "id": 0,
    "username": "string",
    "first_name": "string",
    "last_name": "string"

}
```
*Response sample (400):*
```python
{
    «field_name»: [
      «Обязательное поле.»
    ]
}
```

2) Получение токена

POST-запрос: /api/auth/token/login/
<br /> *Request sample:*
```python
{
    «email»: «string»,
    «password»: «string»
}
```
*Response sample (201):*
```python
{
    «token»: «string»
}
```
*Response sample (400):*
```python
{
    «field_name»: [
      «string»
    ]
}
```

---
### Автор
[Спицын Максим](https://github.com/mspitsyn)